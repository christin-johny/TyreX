<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <link rel="icon" type="image/svg" sizes="20x20" href="/img/favicon.svg">
    <title>TyreX</title>

    <!-- Custom fonts for this template-->
    <link
      href="/vendor/fontawesome-free/css/all.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
      rel="stylesheet"
    />

    <!-- Custom styles for this template-->
    <link href="/css/sb-admin-2.min.css" rel="stylesheet" />
    <link href="/css/style.css" rel="stylesheet" type="text/css" />
  </head>

  <body class="login-bg-color">
    <div class="container">
      <!-- Outer Row -->
      <div class="row justify-content-center">
        <div class="col-xl-10 col-lg-12 col-md-9">
          <div class="card o-hidden border-0 shadow-lg my-5">
            <div class="card-body p-0">
              <!-- Nested Row within Card Body -->
<!-- Nested Row within Card Body -->
<div class="row">
  <div class="col-lg-6 d-none d-lg-block login-bg-color text-center">
    <img src="/img/logo_white.svg" alt="" />
    <h1 class="admin-login-h4"><strong>Welcome Back</strong></h1>
  </div>
  <div class="col-lg-6">
    <div class="p-5">
      <div class="text-center">
        <h1 class="h4 text-gray-900 mb-2">Change Password</h1>
      </div>
      <form class="user" method="post" action="/resetPassword" onsubmit="return validateForm()">
        <div class="form-group">
          <div class="input-group focus-group">
            <input
              type="password"
              class="form-control form-control-user"
              id="password"
              name="password"
              placeholder="Enter New Password"
              style="border-right: none;"
            />
            <div class="input-group-append">
              <span class="input-group-text bg-transparent" onclick="togglePassword('password', 'toggleIcon1')" style="cursor: pointer; border-left: none;">
                <i id="toggleIcon1" class="fas fa-eye"></i>
              </span>
            </div>
          </div>
          <div id="errorP1" class="text-danger"></div>
        </div>

        <div class="form-group">
          <div class="input-group focus-group">
            <input
              type="password"
              class="form-control form-control-user"
              id="cPassword"
              name="cPassword"
              placeholder="Confirm Password"
              style="border-right: none;"
            />
            <div class="input-group-append">
              <span class="input-group-text bg-transparent" onclick="togglePassword('cPassword', 'toggleIcon2')" style="cursor: pointer; border-left: none;">
                <i id="toggleIcon2" class="fas fa-eye"></i>
              </span>
            </div>
          </div>
          <div id="errorP2" class="text-danger"></div>
        </div>
        
        <% if (success_msg.length > 0) { %>
          <div class="alert alert-success alert-dismissible fade show shadow rounded p-3 text-center" role="alert">
            <%= success_msg %>
          </div>
        <% } %>
        
        <% if (error_msg.length > 0) { %>
          <div class="alert alert-danger alert-dismissible fade show shadow rounded p-3 text-center" role="alert">
            <%= error_msg %>
          </div>
        <% } %>

        <button type="submit" class="btn btn-primary btn-user btn-block">
          Reset Password
        </button>
      </form>
      <hr />
      <div class="text-center">
        <a class="small" href="/signup">Create an Account!</a>
      </div>
      <div class="text-center">
        <a class="small" href="/login">Already have an account? Login!</a>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap core JavaScript-->
<script src="/vendor/jquery/jquery.min.js"></script>
<script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Core plugin JavaScript-->
<script src="/vendor/jquery-easing/jquery.easing.min.js"></script>

<!-- Custom scripts for all pages-->
<script src="js/sb-admin-2.min.js"></script>

<style>
  /* Password field styling */
  .input-group > .form-control:not(:last-child),
  .input-group > .custom-select:not(:last-child) {
    border-top-right-radius: 10rem;
    border-bottom-right-radius: 10rem;
  }
  .input-group > .input-group-append:last-child > .input-group-text {
    border-top-right-radius: 10rem;
    border-bottom-right-radius: 10rem;
  }
  
  /* Focus styling for both fields */
  .focus-group:focus-within {
    box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
    border-radius: 10rem;
    transition: all 0.3s;
  }
  .focus-group:focus-within .form-control,
  .focus-group:focus-within .input-group-text {
    border-color: #4e73df;
    outline: none;
  }
</style>

<script>
  function togglePassword(fieldId, iconId) {
    var passwordInput = document.getElementById(fieldId);
    var icon = document.getElementById(iconId);
    if (passwordInput.type === "password") {
      passwordInput.type = "text";
      icon.classList.remove("fa-eye");
      icon.classList.add("fa-eye-slash");
    } else {
      passwordInput.type = "password";
      icon.classList.remove("fa-eye-slash");
      icon.classList.add("fa-eye");
    }
    passwordInput.focus();
  }

  function validateForm() {
    let valid = true;
    const password = document.getElementById('password');
    const cPassword = document.getElementById("cPassword");
    const errorP1 = document.getElementById("errorP1");
    const errorP2 = document.getElementById("errorP2");

    errorP1.textContent = "";
    errorP2.textContent = "";

    const alpha = /^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;

    if (password.value.trim() === '') {
      errorP1.textContent = 'Password cannot be empty';
      valid = false;
    } else if (password.value.length < 8) {
      errorP1.textContent = 'Password must be at least 8 characters long';
      valid = false;
    } else if (!alpha.test(password.value)) {
      errorP1.textContent = "Password must include uppercase, lowercase, number, and special character";
      valid = false;
    }

    if (cPassword.value.trim() === '') {
      errorP2.textContent = "Please Re-enter the password";
      valid = false;
    } else if (password.value !== cPassword.value) {
      errorP2.textContent = "Passwords do not match";
      valid = false;
    }

    return valid;
  }
</script>